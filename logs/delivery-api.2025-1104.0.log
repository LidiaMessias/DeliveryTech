2025-11-04 11:41:18.457 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - Starting DeliveryApiApplication using Java 17.0.16 with PID 18480 (C:\Users\lidia\OneDrive\Documentos\Curso Arquitetura de Sistemas\deliverytech\delivery-api\target\classes started by lidia in C:\Users\lidia\OneDrive\Documentos\Curso Arquitetura de Sistemas\deliverytech)
2025-11-04 11:41:18.458 [restartedMain] DEBUG [] c.d.d.DeliveryApiApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-11-04 11:41:18.458 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - No active profile set, falling back to 1 default profile: "default"
2025-11-04 11:41:18.763 [restartedMain] INFO  [] o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-04 11:41:18.788 [restartedMain] INFO  [] o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 24 ms. Found 5 JPA repository interfaces.
2025-11-04 11:41:18.891 [restartedMain] INFO  [] o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-04 11:41:18.892 [restartedMain] INFO  [] o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-04 11:41:18.892 [restartedMain] INFO  [] o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-11-04 11:41:18.914 [restartedMain] INFO  [] o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-11-04 11:41:18.914 [restartedMain] INFO  [] o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 454 ms
2025-11-04 11:41:18.973 [restartedMain] INFO  [] o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-04 11:41:18.974 [restartedMain] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-10 - Starting...
2025-11-04 11:41:18.977 [restartedMain] INFO  [] com.zaxxer.hikari.pool.HikariPool - HikariPool-10 - Added connection conn94: url=jdbc:h2:mem:deliverydb user=SA
2025-11-04 11:41:18.977 [restartedMain] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-10 - Start completed.
2025-11-04 11:41:18.978 [restartedMain] WARN  [] org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-11-04 11:41:19.114 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists cliente cascade 
2025-11-04 11:41:19.115 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists item_pedido cascade 
2025-11-04 11:41:19.115 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists pedido cascade 
2025-11-04 11:41:19.115 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists produto cascade 
2025-11-04 11:41:19.116 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists restaurante cascade 
2025-11-04 11:41:19.117 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists usuario cascade 
2025-11-04 11:41:19.117 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table cliente (
        ativo boolean not null,
        data_criacao timestamp(6),
        id bigint generated by default as identity,
        email varchar(255) not null unique,
        endereco varchar(255),
        nome varchar(255) not null,
        telefone varchar(255) not null,
        primary key (id)
    )
2025-11-04 11:41:19.120 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table item_pedido (
        preco_unitario numeric(38,2) not null,
        quantidade integer not null,
        subtotal numeric(38,2) not null,
        id bigint generated by default as identity,
        pedido_id bigint not null,
        produto_id bigint not null,
        observacoes varchar(255),
        primary key (id)
    )
2025-11-04 11:41:19.122 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table pedido (
        subtotal numeric(38,2),
        taxa_entrega numeric(38,2),
        valor_total numeric(38,2),
        cliente_id bigint,
        data_pedido timestamp(6),
        id bigint generated by default as identity,
        restaurante_id bigint,
        cep varchar(255),
        endereco_entrega varchar(255),
        forma_pagamento varchar(255),
        observacoes varchar(255),
        status enum ('CANCELADO','CONFIRMADO','ENTREGUE','PENDENTE','PREPARANDO','SAIU_PARA_ENTREGA'),
        primary key (id)
    )
2025-11-04 11:41:19.125 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table produto (
        disponivel boolean not null,
        preco numeric(38,2),
        id bigint generated by default as identity,
        restaurante_id bigint not null,
        categoria varchar(255),
        descricao varchar(255),
        imagem_url varchar(255),
        nome varchar(255),
        primary key (id)
    )
2025-11-04 11:41:19.126 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table restaurante (
        ativo boolean not null,
        avaliacao numeric(38,2),
        taxa_entrega numeric(38,2),
        tempo_entrega integer,
        id bigint generated by default as identity,
        categoria varchar(255),
        endereco varchar(255),
        horario_funcionamento varchar(255),
        nome varchar(255),
        telefone varchar(255),
        primary key (id)
    )
2025-11-04 11:41:19.128 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table usuario (
        ativo boolean not null,
        data_criacao timestamp(6) not null,
        id bigint generated by default as identity,
        restaurante_id bigint,
        email varchar(255) not null unique,
        nome varchar(255) not null,
        senha varchar(255) not null,
        role enum ('ADMIN','CLIENTE','ENTREGADOR','RESTAURANTE') not null,
        primary key (id)
    )
2025-11-04 11:41:19.131 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists item_pedido 
       add constraint FK60ym08cfoysa17wrn1swyiuda 
       foreign key (pedido_id) 
       references pedido
2025-11-04 11:41:19.133 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists item_pedido 
       add constraint FKtk55mn6d6bvl5h0no5uagi3sf 
       foreign key (produto_id) 
       references produto
2025-11-04 11:41:19.134 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists pedido 
       add constraint FK30s8j2ktpay6of18lbyqn3632 
       foreign key (cliente_id) 
       references cliente
2025-11-04 11:41:19.136 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists pedido 
       add constraint FK3eud5cqmgsnltyk704hu3qj71 
       foreign key (restaurante_id) 
       references restaurante
2025-11-04 11:41:19.137 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists produto 
       add constraint FKb9jhjyghjcn25guim7q4pt8qx 
       foreign key (restaurante_id) 
       references restaurante
2025-11-04 11:41:19.140 [restartedMain] INFO  [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-04 11:41:19.183 [restartedMain] DEBUG [] c.d.d.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-04 11:41:19.183 [restartedMain] DEBUG [] o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-11-04 11:41:19.251 [restartedMain] INFO  [] o.s.s.c.a.a.c.InitializeAuthenticationProviderBeanManagerConfigurer$InitializeAuthenticationProviderManagerConfigurer - Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2025-11-04 11:41:19.252 [restartedMain] WARN  [] o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used by Spring Security for automatically configuring username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider. If the current configuration is intentional, to turn off this warning, increase the logging level of 'org.springframework.security.config.annotation.authentication.configuration.InitializeUserDetailsBeanManagerConfigurer' to ERROR
2025-11-04 11:41:19.318 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'CLIENTE\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.criarPedido(com.deliverytech.delivery_api.dto.PedidoDTO)
2025-11-04 11:41:19.319 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.criarPedido(com.deliverytech.delivery_api.dto.PedidoDTO)]] with attributes [[authorize: 'hasRole('CLIENTE')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:41:19.322 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.listarPedidos(com.deliverytech.delivery_api.model.StatusPedido,java.time.LocalDate,java.time.LocalDate,org.springframework.data.domain.Pageable)
2025-11-04 11:41:19.322 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.listarPedidos(com.deliverytech.delivery_api.model.StatusPedido,java.time.LocalDate,java.time.LocalDate,org.springframework.data.domain.Pageable)]] with attributes [[authorize: 'hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:41:19.323 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'RESTAURANTE\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.buscarPorRestaurante(java.lang.Long,com.deliverytech.delivery_api.model.StatusPedido)
2025-11-04 11:41:19.323 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.buscarPorRestaurante(java.lang.Long,com.deliverytech.delivery_api.model.StatusPedido)]] with attributes [[authorize: 'hasRole('RESTAURANTE')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:41:19.333 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'RESTAURANTE\') or hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.cadastrarProduto(com.deliverytech.delivery_api.dto.ProdutoDTO,java.lang.Long)
2025-11-04 11:41:19.334 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.cadastrarProduto(com.deliverytech.delivery_api.dto.ProdutoDTO,java.lang.Long)]] with attributes [[authorize: 'hasRole('RESTAURANTE') or hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:41:19.334 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or @produtoService.isOwner(#id)") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.removerProduto(java.lang.Long)
2025-11-04 11:41:19.336 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.removerProduto(java.lang.Long)]] with attributes [[authorize: 'hasRole('ADMIN') or @produtoService.isOwner(#id)', filter: 'null', filterTarget: 'null']]
2025-11-04 11:41:19.336 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or @produtoService.isOwner(#id)") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.atualizarProduto(java.lang.Long,com.deliverytech.delivery_api.dto.ProdutoDTO)
2025-11-04 11:41:19.336 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.atualizarProduto(java.lang.Long,com.deliverytech.delivery_api.dto.ProdutoDTO)]] with attributes [[authorize: 'hasRole('ADMIN') or @produtoService.isOwner(#id)', filter: 'null', filterTarget: 'null']]
2025-11-04 11:41:19.348 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.cadastrarRestaurante(com.deliverytech.delivery_api.dto.RestauranteDTO)
2025-11-04 11:41:19.349 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.RestauranteController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.cadastrarRestaurante(com.deliverytech.delivery_api.dto.RestauranteDTO)]] with attributes [[authorize: 'hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:41:19.350 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or (hasRole(\'RESTAURANTE\') and @restauranteService.isOwner(#id))") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.atualizarRestaurante(java.lang.Long,com.deliverytech.delivery_api.dto.RestauranteDTO)
2025-11-04 11:41:19.350 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.RestauranteController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.atualizarRestaurante(java.lang.Long,com.deliverytech.delivery_api.dto.RestauranteDTO)]] with attributes [[authorize: 'hasRole('ADMIN') or (hasRole('RESTAURANTE') and @restauranteService.isOwner(#id))', filter: 'null', filterTarget: 'null']]
2025-11-04 11:41:19.412 [restartedMain] DEBUG [] o.s.w.s.m.m.a.RequestMappingHandlerMapping - 43 mappings in 'requestMappingHandlerMapping'
2025-11-04 11:41:19.456 [restartedMain] DEBUG [] o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**, /swagger-ui*/*swagger-initializer.js, /swagger-ui*/**] in 'resourceHandlerMapping'
2025-11-04 11:41:19.488 [restartedMain] INFO  [] o.s.b.a.e.web.EndpointLinksResolver - Exposing 6 endpoints beneath base path '/actuator'
2025-11-04 11:41:19.517 [restartedMain] DEBUG [] o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-11-04 11:41:19.533 [restartedMain] DEBUG [] o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-11-04 11:41:19.539 [restartedMain] DEBUG [] o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 2 @ExceptionHandler, 1 ResponseBodyAdvice
2025-11-04 11:41:19.576 [restartedMain] INFO  [] o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:deliverydb'
2025-11-04 11:41:19.588 [restartedMain] INFO  [] o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-11-04 11:41:19.606 [restartedMain] INFO  [] o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-11-04 11:41:19.612 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - Started DeliveryApiApplication in 1.201 seconds (process running for 4916.7)
2025-11-04 11:41:19.617 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Cliente */insert 
    into
        cliente (ativo, data_criacao, email, endereco, nome, telefone, id) 
    values
        (?, ?, ?, ?, ?, ?, default)
2025-11-04 11:41:19.623 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Cliente */insert 
    into
        cliente (ativo, data_criacao, email, endereco, nome, telefone, id) 
    values
        (?, ?, ?, ?, ?, ?, default)
2025-11-04 11:41:19.627 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Restaurante */insert 
    into
        restaurante (ativo, avaliacao, categoria, endereco, horario_funcionamento, nome, taxa_entrega, telefone, tempo_entrega, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2025-11-04 11:41:19.630 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Restaurante */insert 
    into
        restaurante (ativo, avaliacao, categoria, endereco, horario_funcionamento, nome, taxa_entrega, telefone, tempo_entrega, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2025-11-04 11:41:19.651 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        c1_0.email=?
2025-11-04 11:41:19.658 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        c1_0.ativo
2025-11-04 11:41:19.664 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        upper(c1_0.nome) like upper(?) escape '\'
2025-11-04 11:41:19.670 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id 
    from
        cliente c1_0 
    where
        c1_0.email=? 
    fetch
        first ? rows only
2025-11-04 11:41:19.675 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.ativo
2025-11-04 11:41:19.682 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.categoria=?
2025-11-04 11:41:19.686 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.taxa_entrega<=?
2025-11-04 11:41:19.691 [restartedMain] INFO  [] o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation unchanged
2025-11-04 11:48:52.134 [File Watcher] INFO  [] o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (1 addition, 0 deletions, 0 modifications)
2025-11-04 11:48:52.136 [Thread-40] INFO  [] o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-11-04 11:48:52.222 [tomcat-shutdown] INFO  [] o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-11-04 11:48:52.225 [Thread-40] INFO  [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-04 11:48:52.226 [Thread-40] DEBUG [] org.hibernate.SQL - 
    drop table if exists cliente cascade 
2025-11-04 11:48:52.226 [Thread-40] DEBUG [] org.hibernate.SQL - 
    drop table if exists item_pedido cascade 
2025-11-04 11:48:52.227 [Thread-40] DEBUG [] org.hibernate.SQL - 
    drop table if exists pedido cascade 
2025-11-04 11:48:52.228 [Thread-40] DEBUG [] org.hibernate.SQL - 
    drop table if exists produto cascade 
2025-11-04 11:48:52.228 [Thread-40] DEBUG [] org.hibernate.SQL - 
    drop table if exists restaurante cascade 
2025-11-04 11:48:52.229 [Thread-40] DEBUG [] org.hibernate.SQL - 
    drop table if exists usuario cascade 
2025-11-04 11:48:52.230 [Thread-40] WARN  [] o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-11-04 11:48:52.230 [Thread-40] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-10 - Shutdown initiated...
2025-11-04 11:48:52.231 [Thread-40] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-10 - Shutdown completed.
2025-11-04 11:48:52.365 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - Starting DeliveryApiApplication using Java 17.0.16 with PID 18480 (C:\Users\lidia\OneDrive\Documentos\Curso Arquitetura de Sistemas\deliverytech\delivery-api\target\classes started by lidia in C:\Users\lidia\OneDrive\Documentos\Curso Arquitetura de Sistemas\deliverytech)
2025-11-04 11:48:52.366 [restartedMain] DEBUG [] c.d.d.DeliveryApiApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-11-04 11:48:52.366 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - No active profile set, falling back to 1 default profile: "default"
2025-11-04 11:48:52.628 [restartedMain] INFO  [] o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-04 11:48:52.656 [restartedMain] INFO  [] o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 27 ms. Found 5 JPA repository interfaces.
2025-11-04 11:48:52.734 [restartedMain] INFO  [] o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-04 11:48:52.734 [restartedMain] INFO  [] o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-04 11:48:52.736 [restartedMain] INFO  [] o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-11-04 11:48:52.757 [restartedMain] INFO  [] o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-11-04 11:48:52.757 [restartedMain] INFO  [] o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 389 ms
2025-11-04 11:48:52.831 [restartedMain] INFO  [] o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-04 11:48:52.832 [restartedMain] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-11 - Starting...
2025-11-04 11:48:52.834 [restartedMain] INFO  [] com.zaxxer.hikari.pool.HikariPool - HikariPool-11 - Added connection conn104: url=jdbc:h2:mem:deliverydb user=SA
2025-11-04 11:48:52.834 [restartedMain] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-11 - Start completed.
2025-11-04 11:48:52.835 [restartedMain] WARN  [] org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-11-04 11:48:52.970 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists cliente cascade 
2025-11-04 11:48:52.971 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists item_pedido cascade 
2025-11-04 11:48:52.972 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists pedido cascade 
2025-11-04 11:48:52.972 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists produto cascade 
2025-11-04 11:48:52.973 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists restaurante cascade 
2025-11-04 11:48:52.973 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists usuario cascade 
2025-11-04 11:48:52.974 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table cliente (
        ativo boolean not null,
        data_criacao timestamp(6),
        id bigint generated by default as identity,
        email varchar(255) not null unique,
        endereco varchar(255),
        nome varchar(255) not null,
        telefone varchar(255) not null,
        primary key (id)
    )
2025-11-04 11:48:52.975 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table item_pedido (
        preco_unitario numeric(38,2) not null,
        quantidade integer not null,
        subtotal numeric(38,2) not null,
        id bigint generated by default as identity,
        pedido_id bigint not null,
        produto_id bigint not null,
        observacoes varchar(255),
        primary key (id)
    )
2025-11-04 11:48:52.976 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table pedido (
        subtotal numeric(38,2),
        taxa_entrega numeric(38,2),
        valor_total numeric(38,2),
        cliente_id bigint,
        data_pedido timestamp(6),
        id bigint generated by default as identity,
        restaurante_id bigint,
        cep varchar(255),
        endereco_entrega varchar(255),
        forma_pagamento varchar(255),
        observacoes varchar(255),
        status enum ('CANCELADO','CONFIRMADO','ENTREGUE','PENDENTE','PREPARANDO','SAIU_PARA_ENTREGA'),
        primary key (id)
    )
2025-11-04 11:48:52.978 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table produto (
        disponivel boolean not null,
        preco numeric(38,2),
        id bigint generated by default as identity,
        restaurante_id bigint not null,
        categoria varchar(255),
        descricao varchar(255),
        imagem_url varchar(255),
        nome varchar(255),
        primary key (id)
    )
2025-11-04 11:48:52.981 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table restaurante (
        ativo boolean not null,
        avaliacao numeric(38,2),
        taxa_entrega numeric(38,2),
        tempo_entrega integer,
        id bigint generated by default as identity,
        categoria varchar(255),
        endereco varchar(255),
        horario_funcionamento varchar(255),
        nome varchar(255),
        telefone varchar(255),
        primary key (id)
    )
2025-11-04 11:48:52.982 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table usuario (
        ativo boolean not null,
        data_criacao timestamp(6) not null,
        id bigint generated by default as identity,
        restaurante_id bigint,
        email varchar(255) not null unique,
        nome varchar(255) not null,
        senha varchar(255) not null,
        role enum ('ADMIN','CLIENTE','ENTREGADOR','RESTAURANTE') not null,
        primary key (id)
    )
2025-11-04 11:48:52.984 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists item_pedido 
       add constraint FK60ym08cfoysa17wrn1swyiuda 
       foreign key (pedido_id) 
       references pedido
2025-11-04 11:48:52.985 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists item_pedido 
       add constraint FKtk55mn6d6bvl5h0no5uagi3sf 
       foreign key (produto_id) 
       references produto
2025-11-04 11:48:52.986 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists pedido 
       add constraint FK30s8j2ktpay6of18lbyqn3632 
       foreign key (cliente_id) 
       references cliente
2025-11-04 11:48:52.988 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists pedido 
       add constraint FK3eud5cqmgsnltyk704hu3qj71 
       foreign key (restaurante_id) 
       references restaurante
2025-11-04 11:48:52.990 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists produto 
       add constraint FKb9jhjyghjcn25guim7q4pt8qx 
       foreign key (restaurante_id) 
       references restaurante
2025-11-04 11:48:52.992 [restartedMain] INFO  [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-04 11:48:53.035 [restartedMain] DEBUG [] c.d.d.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-04 11:48:53.035 [restartedMain] DEBUG [] o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-11-04 11:48:53.092 [restartedMain] INFO  [] o.s.s.c.a.a.c.InitializeAuthenticationProviderBeanManagerConfigurer$InitializeAuthenticationProviderManagerConfigurer - Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2025-11-04 11:48:53.093 [restartedMain] WARN  [] o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used by Spring Security for automatically configuring username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider. If the current configuration is intentional, to turn off this warning, increase the logging level of 'org.springframework.security.config.annotation.authentication.configuration.InitializeUserDetailsBeanManagerConfigurer' to ERROR
2025-11-04 11:48:53.146 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'CLIENTE\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.criarPedido(com.deliverytech.delivery_api.dto.PedidoDTO)
2025-11-04 11:48:53.146 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.criarPedido(com.deliverytech.delivery_api.dto.PedidoDTO)]] with attributes [[authorize: 'hasRole('CLIENTE')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:48:53.149 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.listarPedidos(com.deliverytech.delivery_api.model.StatusPedido,java.time.LocalDate,java.time.LocalDate,org.springframework.data.domain.Pageable)
2025-11-04 11:48:53.149 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.listarPedidos(com.deliverytech.delivery_api.model.StatusPedido,java.time.LocalDate,java.time.LocalDate,org.springframework.data.domain.Pageable)]] with attributes [[authorize: 'hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:48:53.150 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'RESTAURANTE\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.buscarPorRestaurante(java.lang.Long,com.deliverytech.delivery_api.model.StatusPedido)
2025-11-04 11:48:53.150 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.buscarPorRestaurante(java.lang.Long,com.deliverytech.delivery_api.model.StatusPedido)]] with attributes [[authorize: 'hasRole('RESTAURANTE')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:48:53.161 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'RESTAURANTE\') or hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.cadastrarProduto(com.deliverytech.delivery_api.dto.ProdutoDTO,java.lang.Long)
2025-11-04 11:48:53.161 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.cadastrarProduto(com.deliverytech.delivery_api.dto.ProdutoDTO,java.lang.Long)]] with attributes [[authorize: 'hasRole('RESTAURANTE') or hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:48:53.162 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or @produtoService.isOwner(#id)") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.removerProduto(java.lang.Long)
2025-11-04 11:48:53.164 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.removerProduto(java.lang.Long)]] with attributes [[authorize: 'hasRole('ADMIN') or @produtoService.isOwner(#id)', filter: 'null', filterTarget: 'null']]
2025-11-04 11:48:53.164 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or @produtoService.isOwner(#id)") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.atualizarProduto(java.lang.Long,com.deliverytech.delivery_api.dto.ProdutoDTO)
2025-11-04 11:48:53.164 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.atualizarProduto(java.lang.Long,com.deliverytech.delivery_api.dto.ProdutoDTO)]] with attributes [[authorize: 'hasRole('ADMIN') or @produtoService.isOwner(#id)', filter: 'null', filterTarget: 'null']]
2025-11-04 11:48:53.176 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.cadastrarRestaurante(com.deliverytech.delivery_api.dto.RestauranteDTO)
2025-11-04 11:48:53.177 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.RestauranteController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.cadastrarRestaurante(com.deliverytech.delivery_api.dto.RestauranteDTO)]] with attributes [[authorize: 'hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:48:53.178 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or (hasRole(\'RESTAURANTE\') and @restauranteService.isOwner(#id))") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.atualizarRestaurante(java.lang.Long,com.deliverytech.delivery_api.dto.RestauranteDTO)
2025-11-04 11:48:53.178 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.RestauranteController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.atualizarRestaurante(java.lang.Long,com.deliverytech.delivery_api.dto.RestauranteDTO)]] with attributes [[authorize: 'hasRole('ADMIN') or (hasRole('RESTAURANTE') and @restauranteService.isOwner(#id))', filter: 'null', filterTarget: 'null']]
2025-11-04 11:48:53.221 [restartedMain] DEBUG [] o.s.w.s.m.m.a.RequestMappingHandlerMapping - 43 mappings in 'requestMappingHandlerMapping'
2025-11-04 11:48:53.245 [restartedMain] DEBUG [] o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**, /swagger-ui*/*swagger-initializer.js, /swagger-ui*/**] in 'resourceHandlerMapping'
2025-11-04 11:48:53.277 [restartedMain] INFO  [] o.s.b.a.e.web.EndpointLinksResolver - Exposing 6 endpoints beneath base path '/actuator'
2025-11-04 11:48:53.309 [restartedMain] DEBUG [] o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-11-04 11:48:53.330 [restartedMain] DEBUG [] o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-11-04 11:48:53.335 [restartedMain] DEBUG [] o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 2 @ExceptionHandler, 1 ResponseBodyAdvice
2025-11-04 11:48:53.379 [restartedMain] INFO  [] o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:deliverydb'
2025-11-04 11:48:53.393 [restartedMain] INFO  [] o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-11-04 11:48:53.408 [restartedMain] INFO  [] o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-11-04 11:48:53.413 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - Started DeliveryApiApplication in 1.096 seconds (process running for 5370.501)
2025-11-04 11:48:53.418 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Cliente */insert 
    into
        cliente (ativo, data_criacao, email, endereco, nome, telefone, id) 
    values
        (?, ?, ?, ?, ?, ?, default)
2025-11-04 11:48:53.424 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Cliente */insert 
    into
        cliente (ativo, data_criacao, email, endereco, nome, telefone, id) 
    values
        (?, ?, ?, ?, ?, ?, default)
2025-11-04 11:48:53.429 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Restaurante */insert 
    into
        restaurante (ativo, avaliacao, categoria, endereco, horario_funcionamento, nome, taxa_entrega, telefone, tempo_entrega, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2025-11-04 11:48:53.431 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Restaurante */insert 
    into
        restaurante (ativo, avaliacao, categoria, endereco, horario_funcionamento, nome, taxa_entrega, telefone, tempo_entrega, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2025-11-04 11:48:53.452 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        c1_0.email=?
2025-11-04 11:48:53.459 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        c1_0.ativo
2025-11-04 11:48:53.465 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        upper(c1_0.nome) like upper(?) escape '\'
2025-11-04 11:48:53.472 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id 
    from
        cliente c1_0 
    where
        c1_0.email=? 
    fetch
        first ? rows only
2025-11-04 11:48:53.476 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.ativo
2025-11-04 11:48:53.480 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.categoria=?
2025-11-04 11:48:53.485 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.taxa_entrega<=?
2025-11-04 11:48:53.489 [restartedMain] INFO  [] o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation unchanged
2025-11-04 11:59:09.584 [File Watcher] INFO  [] o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (0 additions, 0 deletions, 1 modification)
2025-11-04 11:59:09.587 [Thread-50] INFO  [] o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-11-04 11:59:09.624 [tomcat-shutdown] INFO  [] o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-11-04 11:59:09.626 [Thread-50] INFO  [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-04 11:59:09.626 [Thread-50] DEBUG [] org.hibernate.SQL - 
    drop table if exists cliente cascade 
2025-11-04 11:59:09.626 [Thread-50] DEBUG [] org.hibernate.SQL - 
    drop table if exists item_pedido cascade 
2025-11-04 11:59:09.626 [Thread-50] DEBUG [] org.hibernate.SQL - 
    drop table if exists pedido cascade 
2025-11-04 11:59:09.626 [Thread-50] DEBUG [] org.hibernate.SQL - 
    drop table if exists produto cascade 
2025-11-04 11:59:09.628 [Thread-50] DEBUG [] org.hibernate.SQL - 
    drop table if exists restaurante cascade 
2025-11-04 11:59:09.628 [Thread-50] DEBUG [] org.hibernate.SQL - 
    drop table if exists usuario cascade 
2025-11-04 11:59:09.630 [Thread-50] WARN  [] o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-11-04 11:59:09.630 [Thread-50] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-11 - Shutdown initiated...
2025-11-04 11:59:09.632 [Thread-50] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-11 - Shutdown completed.
2025-11-04 11:59:09.722 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - Starting DeliveryApiApplication using Java 17.0.16 with PID 18480 (C:\Users\lidia\OneDrive\Documentos\Curso Arquitetura de Sistemas\deliverytech\delivery-api\target\classes started by lidia in C:\Users\lidia\OneDrive\Documentos\Curso Arquitetura de Sistemas\deliverytech)
2025-11-04 11:59:09.723 [restartedMain] DEBUG [] c.d.d.DeliveryApiApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-11-04 11:59:09.723 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - No active profile set, falling back to 1 default profile: "default"
2025-11-04 11:59:09.880 [restartedMain] INFO  [] o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-04 11:59:09.896 [restartedMain] INFO  [] o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 12 ms. Found 5 JPA repository interfaces.
2025-11-04 11:59:09.943 [restartedMain] INFO  [] o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-04 11:59:09.949 [restartedMain] INFO  [] o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-04 11:59:09.949 [restartedMain] INFO  [] o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-11-04 11:59:09.960 [restartedMain] INFO  [] o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-11-04 11:59:09.960 [restartedMain] INFO  [] o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 235 ms
2025-11-04 11:59:09.993 [restartedMain] INFO  [] o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-04 11:59:09.993 [restartedMain] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-12 - Starting...
2025-11-04 11:59:10.000 [restartedMain] INFO  [] com.zaxxer.hikari.pool.HikariPool - HikariPool-12 - Added connection conn114: url=jdbc:h2:mem:deliverydb user=SA
2025-11-04 11:59:10.000 [restartedMain] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-12 - Start completed.
2025-11-04 11:59:10.001 [restartedMain] WARN  [] org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-11-04 11:59:10.083 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists cliente cascade 
2025-11-04 11:59:10.085 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists item_pedido cascade 
2025-11-04 11:59:10.086 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists pedido cascade 
2025-11-04 11:59:10.086 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists produto cascade 
2025-11-04 11:59:10.087 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists restaurante cascade 
2025-11-04 11:59:10.087 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists usuario cascade 
2025-11-04 11:59:10.088 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table cliente (
        ativo boolean not null,
        data_criacao timestamp(6),
        id bigint generated by default as identity,
        email varchar(255) not null unique,
        endereco varchar(255),
        nome varchar(255) not null,
        telefone varchar(255) not null,
        primary key (id)
    )
2025-11-04 11:59:10.089 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table item_pedido (
        preco_unitario numeric(38,2) not null,
        quantidade integer not null,
        subtotal numeric(38,2) not null,
        id bigint generated by default as identity,
        pedido_id bigint not null,
        produto_id bigint not null,
        observacoes varchar(255),
        primary key (id)
    )
2025-11-04 11:59:10.091 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table pedido (
        subtotal numeric(38,2),
        taxa_entrega numeric(38,2),
        valor_total numeric(38,2),
        cliente_id bigint,
        data_pedido timestamp(6),
        id bigint generated by default as identity,
        restaurante_id bigint,
        cep varchar(255),
        endereco_entrega varchar(255),
        forma_pagamento varchar(255),
        observacoes varchar(255),
        status enum ('CANCELADO','CONFIRMADO','ENTREGUE','PENDENTE','PREPARANDO','SAIU_PARA_ENTREGA'),
        primary key (id)
    )
2025-11-04 11:59:10.092 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table produto (
        disponivel boolean not null,
        preco numeric(38,2),
        id bigint generated by default as identity,
        restaurante_id bigint not null,
        categoria varchar(255),
        descricao varchar(255),
        imagem_url varchar(255),
        nome varchar(255),
        primary key (id)
    )
2025-11-04 11:59:10.093 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table restaurante (
        ativo boolean not null,
        avaliacao numeric(38,2),
        taxa_entrega numeric(38,2),
        tempo_entrega integer,
        id bigint generated by default as identity,
        categoria varchar(255),
        endereco varchar(255),
        horario_funcionamento varchar(255),
        nome varchar(255),
        telefone varchar(255),
        primary key (id)
    )
2025-11-04 11:59:10.093 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table usuario (
        ativo boolean not null,
        data_criacao timestamp(6) not null,
        id bigint generated by default as identity,
        restaurante_id bigint,
        email varchar(255) not null unique,
        nome varchar(255) not null,
        senha varchar(255) not null,
        role enum ('ADMIN','CLIENTE','ENTREGADOR','RESTAURANTE') not null,
        primary key (id)
    )
2025-11-04 11:59:10.094 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists item_pedido 
       add constraint FK60ym08cfoysa17wrn1swyiuda 
       foreign key (pedido_id) 
       references pedido
2025-11-04 11:59:10.095 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists item_pedido 
       add constraint FKtk55mn6d6bvl5h0no5uagi3sf 
       foreign key (produto_id) 
       references produto
2025-11-04 11:59:10.096 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists pedido 
       add constraint FK30s8j2ktpay6of18lbyqn3632 
       foreign key (cliente_id) 
       references cliente
2025-11-04 11:59:10.097 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists pedido 
       add constraint FK3eud5cqmgsnltyk704hu3qj71 
       foreign key (restaurante_id) 
       references restaurante
2025-11-04 11:59:10.097 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists produto 
       add constraint FKb9jhjyghjcn25guim7q4pt8qx 
       foreign key (restaurante_id) 
       references restaurante
2025-11-04 11:59:10.099 [restartedMain] INFO  [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-04 11:59:10.137 [restartedMain] DEBUG [] c.d.d.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-04 11:59:10.137 [restartedMain] DEBUG [] o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-11-04 11:59:10.189 [restartedMain] INFO  [] o.s.s.c.a.a.c.InitializeAuthenticationProviderBeanManagerConfigurer$InitializeAuthenticationProviderManagerConfigurer - Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2025-11-04 11:59:10.190 [restartedMain] WARN  [] o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used by Spring Security for automatically configuring username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider. If the current configuration is intentional, to turn off this warning, increase the logging level of 'org.springframework.security.config.annotation.authentication.configuration.InitializeUserDetailsBeanManagerConfigurer' to ERROR
2025-11-04 11:59:10.223 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'CLIENTE\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.criarPedido(com.deliverytech.delivery_api.dto.PedidoDTO)
2025-11-04 11:59:10.223 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.criarPedido(com.deliverytech.delivery_api.dto.PedidoDTO)]] with attributes [[authorize: 'hasRole('CLIENTE')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:59:10.223 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.listarPedidos(com.deliverytech.delivery_api.model.StatusPedido,java.time.LocalDate,java.time.LocalDate,org.springframework.data.domain.Pageable)
2025-11-04 11:59:10.223 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.listarPedidos(com.deliverytech.delivery_api.model.StatusPedido,java.time.LocalDate,java.time.LocalDate,org.springframework.data.domain.Pageable)]] with attributes [[authorize: 'hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:59:10.223 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'RESTAURANTE\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.buscarPorRestaurante(java.lang.Long,com.deliverytech.delivery_api.model.StatusPedido)
2025-11-04 11:59:10.223 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.buscarPorRestaurante(java.lang.Long,com.deliverytech.delivery_api.model.StatusPedido)]] with attributes [[authorize: 'hasRole('RESTAURANTE')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:59:10.237 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'RESTAURANTE\') or hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.cadastrarProduto(com.deliverytech.delivery_api.dto.ProdutoDTO,java.lang.Long)
2025-11-04 11:59:10.237 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.cadastrarProduto(com.deliverytech.delivery_api.dto.ProdutoDTO,java.lang.Long)]] with attributes [[authorize: 'hasRole('RESTAURANTE') or hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:59:10.238 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or @produtoService.isOwner(#id)") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.removerProduto(java.lang.Long)
2025-11-04 11:59:10.238 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.removerProduto(java.lang.Long)]] with attributes [[authorize: 'hasRole('ADMIN') or @produtoService.isOwner(#id)', filter: 'null', filterTarget: 'null']]
2025-11-04 11:59:10.238 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or @produtoService.isOwner(#id)") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.atualizarProduto(java.lang.Long,com.deliverytech.delivery_api.dto.ProdutoDTO)
2025-11-04 11:59:10.239 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.atualizarProduto(java.lang.Long,com.deliverytech.delivery_api.dto.ProdutoDTO)]] with attributes [[authorize: 'hasRole('ADMIN') or @produtoService.isOwner(#id)', filter: 'null', filterTarget: 'null']]
2025-11-04 11:59:10.241 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.cadastrarRestaurante(com.deliverytech.delivery_api.dto.RestauranteDTO)
2025-11-04 11:59:10.241 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.RestauranteController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.cadastrarRestaurante(com.deliverytech.delivery_api.dto.RestauranteDTO)]] with attributes [[authorize: 'hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 11:59:10.241 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or (hasRole(\'RESTAURANTE\') and @restauranteService.isOwner(#id))") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.atualizarRestaurante(java.lang.Long,com.deliverytech.delivery_api.dto.RestauranteDTO)
2025-11-04 11:59:10.241 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.RestauranteController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.atualizarRestaurante(java.lang.Long,com.deliverytech.delivery_api.dto.RestauranteDTO)]] with attributes [[authorize: 'hasRole('ADMIN') or (hasRole('RESTAURANTE') and @restauranteService.isOwner(#id))', filter: 'null', filterTarget: 'null']]
2025-11-04 11:59:10.288 [restartedMain] DEBUG [] o.s.w.s.m.m.a.RequestMappingHandlerMapping - 43 mappings in 'requestMappingHandlerMapping'
2025-11-04 11:59:10.336 [restartedMain] DEBUG [] o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**, /swagger-ui*/*swagger-initializer.js, /swagger-ui*/**] in 'resourceHandlerMapping'
2025-11-04 11:59:10.360 [restartedMain] INFO  [] o.s.b.a.e.web.EndpointLinksResolver - Exposing 6 endpoints beneath base path '/actuator'
2025-11-04 11:59:10.375 [restartedMain] DEBUG [] o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-11-04 11:59:10.390 [restartedMain] DEBUG [] o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-11-04 11:59:10.398 [restartedMain] DEBUG [] o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 2 @ExceptionHandler, 1 ResponseBodyAdvice
2025-11-04 11:59:10.418 [restartedMain] INFO  [] o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:deliverydb'
2025-11-04 11:59:10.429 [restartedMain] INFO  [] o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-11-04 11:59:10.436 [restartedMain] INFO  [] o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-11-04 11:59:10.436 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - Started DeliveryApiApplication in 0.74 seconds (process running for 5987.531)
2025-11-04 11:59:10.447 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Cliente */insert 
    into
        cliente (ativo, data_criacao, email, endereco, nome, telefone, id) 
    values
        (?, ?, ?, ?, ?, ?, default)
2025-11-04 11:59:10.451 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Cliente */insert 
    into
        cliente (ativo, data_criacao, email, endereco, nome, telefone, id) 
    values
        (?, ?, ?, ?, ?, ?, default)
2025-11-04 11:59:10.455 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Restaurante */insert 
    into
        restaurante (ativo, avaliacao, categoria, endereco, horario_funcionamento, nome, taxa_entrega, telefone, tempo_entrega, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2025-11-04 11:59:10.457 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Restaurante */insert 
    into
        restaurante (ativo, avaliacao, categoria, endereco, horario_funcionamento, nome, taxa_entrega, telefone, tempo_entrega, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2025-11-04 11:59:10.472 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        c1_0.email=?
2025-11-04 11:59:10.475 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        c1_0.ativo
2025-11-04 11:59:10.479 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        upper(c1_0.nome) like upper(?) escape '\'
2025-11-04 11:59:10.483 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id 
    from
        cliente c1_0 
    where
        c1_0.email=? 
    fetch
        first ? rows only
2025-11-04 11:59:10.486 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.ativo
2025-11-04 11:59:10.489 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.categoria=?
2025-11-04 11:59:10.493 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.taxa_entrega<=?
2025-11-04 11:59:10.496 [restartedMain] INFO  [] o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation unchanged
2025-11-04 12:01:50.599 [File Watcher] INFO  [] o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (1 addition, 0 deletions, 0 modifications)
2025-11-04 12:01:50.603 [Thread-54] INFO  [] o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-11-04 12:01:50.639 [tomcat-shutdown] INFO  [] o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-11-04 12:01:50.639 [Thread-54] INFO  [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-04 12:01:50.639 [Thread-54] DEBUG [] org.hibernate.SQL - 
    drop table if exists cliente cascade 
2025-11-04 12:01:50.639 [Thread-54] DEBUG [] org.hibernate.SQL - 
    drop table if exists item_pedido cascade 
2025-11-04 12:01:50.639 [Thread-54] DEBUG [] org.hibernate.SQL - 
    drop table if exists pedido cascade 
2025-11-04 12:01:50.639 [Thread-54] DEBUG [] org.hibernate.SQL - 
    drop table if exists produto cascade 
2025-11-04 12:01:50.644 [Thread-54] DEBUG [] org.hibernate.SQL - 
    drop table if exists restaurante cascade 
2025-11-04 12:01:50.644 [Thread-54] DEBUG [] org.hibernate.SQL - 
    drop table if exists usuario cascade 
2025-11-04 12:01:50.644 [Thread-54] WARN  [] o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-11-04 12:01:50.646 [Thread-54] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-12 - Shutdown initiated...
2025-11-04 12:01:50.646 [Thread-54] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-12 - Shutdown completed.
2025-11-04 12:01:50.723 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - Starting DeliveryApiApplication using Java 17.0.16 with PID 18480 (C:\Users\lidia\OneDrive\Documentos\Curso Arquitetura de Sistemas\deliverytech\delivery-api\target\classes started by lidia in C:\Users\lidia\OneDrive\Documentos\Curso Arquitetura de Sistemas\deliverytech)
2025-11-04 12:01:50.723 [restartedMain] DEBUG [] c.d.d.DeliveryApiApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-11-04 12:01:50.723 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - No active profile set, falling back to 1 default profile: "default"
2025-11-04 12:01:50.851 [restartedMain] INFO  [] o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-04 12:01:50.869 [restartedMain] INFO  [] o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 13 ms. Found 5 JPA repository interfaces.
2025-11-04 12:01:50.937 [restartedMain] INFO  [] o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-04 12:01:50.937 [restartedMain] INFO  [] o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-04 12:01:50.938 [restartedMain] INFO  [] o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-11-04 12:01:50.956 [restartedMain] INFO  [] o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-11-04 12:01:50.957 [restartedMain] INFO  [] o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 233 ms
2025-11-04 12:01:50.997 [restartedMain] INFO  [] o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-04 12:01:50.997 [restartedMain] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-13 - Starting...
2025-11-04 12:01:51.002 [restartedMain] INFO  [] com.zaxxer.hikari.pool.HikariPool - HikariPool-13 - Added connection conn124: url=jdbc:h2:mem:deliverydb user=SA
2025-11-04 12:01:51.002 [restartedMain] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-13 - Start completed.
2025-11-04 12:01:51.002 [restartedMain] WARN  [] org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-11-04 12:01:51.100 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists cliente cascade 
2025-11-04 12:01:51.101 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists item_pedido cascade 
2025-11-04 12:01:51.101 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists pedido cascade 
2025-11-04 12:01:51.101 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists produto cascade 
2025-11-04 12:01:51.101 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists restaurante cascade 
2025-11-04 12:01:51.102 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists usuario cascade 
2025-11-04 12:01:51.102 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table cliente (
        ativo boolean not null,
        data_criacao timestamp(6),
        id bigint generated by default as identity,
        email varchar(255) not null unique,
        endereco varchar(255),
        nome varchar(255) not null,
        telefone varchar(255) not null,
        primary key (id)
    )
2025-11-04 12:01:51.104 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table item_pedido (
        preco_unitario numeric(38,2) not null,
        quantidade integer not null,
        subtotal numeric(38,2) not null,
        id bigint generated by default as identity,
        pedido_id bigint not null,
        produto_id bigint not null,
        observacoes varchar(255),
        primary key (id)
    )
2025-11-04 12:01:51.105 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table pedido (
        subtotal numeric(38,2),
        taxa_entrega numeric(38,2),
        valor_total numeric(38,2),
        cliente_id bigint,
        data_pedido timestamp(6),
        id bigint generated by default as identity,
        restaurante_id bigint,
        cep varchar(255),
        endereco_entrega varchar(255),
        forma_pagamento varchar(255),
        observacoes varchar(255),
        status enum ('CANCELADO','CONFIRMADO','ENTREGUE','PENDENTE','PREPARANDO','SAIU_PARA_ENTREGA'),
        primary key (id)
    )
2025-11-04 12:01:51.106 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table produto (
        disponivel boolean not null,
        preco numeric(38,2),
        id bigint generated by default as identity,
        restaurante_id bigint not null,
        categoria varchar(255),
        descricao varchar(255),
        imagem_url varchar(255),
        nome varchar(255),
        primary key (id)
    )
2025-11-04 12:01:51.108 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table restaurante (
        ativo boolean not null,
        avaliacao numeric(38,2),
        taxa_entrega numeric(38,2),
        tempo_entrega integer,
        id bigint generated by default as identity,
        categoria varchar(255),
        endereco varchar(255),
        horario_funcionamento varchar(255),
        nome varchar(255),
        telefone varchar(255),
        primary key (id)
    )
2025-11-04 12:01:51.109 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table usuario (
        ativo boolean not null,
        data_criacao timestamp(6) not null,
        id bigint generated by default as identity,
        restaurante_id bigint,
        email varchar(255) not null unique,
        nome varchar(255) not null,
        senha varchar(255) not null,
        role enum ('ADMIN','CLIENTE','ENTREGADOR','RESTAURANTE') not null,
        primary key (id)
    )
2025-11-04 12:01:51.111 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists item_pedido 
       add constraint FK60ym08cfoysa17wrn1swyiuda 
       foreign key (pedido_id) 
       references pedido
2025-11-04 12:01:51.112 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists item_pedido 
       add constraint FKtk55mn6d6bvl5h0no5uagi3sf 
       foreign key (produto_id) 
       references produto
2025-11-04 12:01:51.113 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists pedido 
       add constraint FK30s8j2ktpay6of18lbyqn3632 
       foreign key (cliente_id) 
       references cliente
2025-11-04 12:01:51.113 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists pedido 
       add constraint FK3eud5cqmgsnltyk704hu3qj71 
       foreign key (restaurante_id) 
       references restaurante
2025-11-04 12:01:51.115 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists produto 
       add constraint FKb9jhjyghjcn25guim7q4pt8qx 
       foreign key (restaurante_id) 
       references restaurante
2025-11-04 12:01:51.117 [restartedMain] INFO  [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-04 12:01:51.151 [restartedMain] DEBUG [] c.d.d.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-04 12:01:51.152 [restartedMain] DEBUG [] o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-11-04 12:01:51.191 [restartedMain] INFO  [] o.s.s.c.a.a.c.InitializeAuthenticationProviderBeanManagerConfigurer$InitializeAuthenticationProviderManagerConfigurer - Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2025-11-04 12:01:51.191 [restartedMain] WARN  [] o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used by Spring Security for automatically configuring username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider. If the current configuration is intentional, to turn off this warning, increase the logging level of 'org.springframework.security.config.annotation.authentication.configuration.InitializeUserDetailsBeanManagerConfigurer' to ERROR
2025-11-04 12:01:51.227 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'CLIENTE\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.criarPedido(com.deliverytech.delivery_api.dto.PedidoDTO)
2025-11-04 12:01:51.227 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.criarPedido(com.deliverytech.delivery_api.dto.PedidoDTO)]] with attributes [[authorize: 'hasRole('CLIENTE')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:01:51.235 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.listarPedidos(com.deliverytech.delivery_api.model.StatusPedido,java.time.LocalDate,java.time.LocalDate,org.springframework.data.domain.Pageable)
2025-11-04 12:01:51.235 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.listarPedidos(com.deliverytech.delivery_api.model.StatusPedido,java.time.LocalDate,java.time.LocalDate,org.springframework.data.domain.Pageable)]] with attributes [[authorize: 'hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:01:51.235 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'RESTAURANTE\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.buscarPorRestaurante(java.lang.Long,com.deliverytech.delivery_api.model.StatusPedido)
2025-11-04 12:01:51.236 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.buscarPorRestaurante(java.lang.Long,com.deliverytech.delivery_api.model.StatusPedido)]] with attributes [[authorize: 'hasRole('RESTAURANTE')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:01:51.240 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'RESTAURANTE\') or hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.cadastrarProduto(com.deliverytech.delivery_api.dto.ProdutoDTO,java.lang.Long)
2025-11-04 12:01:51.240 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.cadastrarProduto(com.deliverytech.delivery_api.dto.ProdutoDTO,java.lang.Long)]] with attributes [[authorize: 'hasRole('RESTAURANTE') or hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:01:51.247 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or @produtoService.isOwner(#id)") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.removerProduto(java.lang.Long)
2025-11-04 12:01:51.247 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.removerProduto(java.lang.Long)]] with attributes [[authorize: 'hasRole('ADMIN') or @produtoService.isOwner(#id)', filter: 'null', filterTarget: 'null']]
2025-11-04 12:01:51.247 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or @produtoService.isOwner(#id)") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.atualizarProduto(java.lang.Long,com.deliverytech.delivery_api.dto.ProdutoDTO)
2025-11-04 12:01:51.248 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.atualizarProduto(java.lang.Long,com.deliverytech.delivery_api.dto.ProdutoDTO)]] with attributes [[authorize: 'hasRole('ADMIN') or @produtoService.isOwner(#id)', filter: 'null', filterTarget: 'null']]
2025-11-04 12:01:51.258 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.cadastrarRestaurante(com.deliverytech.delivery_api.dto.RestauranteDTO)
2025-11-04 12:01:51.258 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.RestauranteController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.cadastrarRestaurante(com.deliverytech.delivery_api.dto.RestauranteDTO)]] with attributes [[authorize: 'hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:01:51.259 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or (hasRole(\'RESTAURANTE\') and @restauranteService.isOwner(#id))") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.atualizarRestaurante(java.lang.Long,com.deliverytech.delivery_api.dto.RestauranteDTO)
2025-11-04 12:01:51.259 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.RestauranteController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.atualizarRestaurante(java.lang.Long,com.deliverytech.delivery_api.dto.RestauranteDTO)]] with attributes [[authorize: 'hasRole('ADMIN') or (hasRole('RESTAURANTE') and @restauranteService.isOwner(#id))', filter: 'null', filterTarget: 'null']]
2025-11-04 12:01:51.324 [restartedMain] DEBUG [] o.s.w.s.m.m.a.RequestMappingHandlerMapping - 43 mappings in 'requestMappingHandlerMapping'
2025-11-04 12:01:51.341 [restartedMain] DEBUG [] o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**, /swagger-ui*/*swagger-initializer.js, /swagger-ui*/**] in 'resourceHandlerMapping'
2025-11-04 12:01:51.358 [restartedMain] INFO  [] o.s.b.a.e.web.EndpointLinksResolver - Exposing 6 endpoints beneath base path '/actuator'
2025-11-04 12:01:51.369 [restartedMain] DEBUG [] o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-11-04 12:01:51.390 [restartedMain] DEBUG [] o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-11-04 12:01:51.402 [restartedMain] DEBUG [] o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 2 @ExceptionHandler, 1 ResponseBodyAdvice
2025-11-04 12:01:51.425 [restartedMain] INFO  [] o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:deliverydb'
2025-11-04 12:01:51.432 [restartedMain] INFO  [] o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-11-04 12:01:51.436 [restartedMain] INFO  [] o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-11-04 12:01:51.450 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - Started DeliveryApiApplication in 0.762 seconds (process running for 6148.537)
2025-11-04 12:01:51.453 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Cliente */insert 
    into
        cliente (ativo, data_criacao, email, endereco, nome, telefone, id) 
    values
        (?, ?, ?, ?, ?, ?, default)
2025-11-04 12:01:51.457 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Cliente */insert 
    into
        cliente (ativo, data_criacao, email, endereco, nome, telefone, id) 
    values
        (?, ?, ?, ?, ?, ?, default)
2025-11-04 12:01:51.459 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Restaurante */insert 
    into
        restaurante (ativo, avaliacao, categoria, endereco, horario_funcionamento, nome, taxa_entrega, telefone, tempo_entrega, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2025-11-04 12:01:51.461 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Restaurante */insert 
    into
        restaurante (ativo, avaliacao, categoria, endereco, horario_funcionamento, nome, taxa_entrega, telefone, tempo_entrega, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2025-11-04 12:01:51.469 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        c1_0.email=?
2025-11-04 12:01:51.476 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        c1_0.ativo
2025-11-04 12:01:51.479 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        upper(c1_0.nome) like upper(?) escape '\'
2025-11-04 12:01:51.480 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id 
    from
        cliente c1_0 
    where
        c1_0.email=? 
    fetch
        first ? rows only
2025-11-04 12:01:51.480 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.ativo
2025-11-04 12:01:51.486 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.categoria=?
2025-11-04 12:01:51.489 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.taxa_entrega<=?
2025-11-04 12:01:51.491 [restartedMain] INFO  [] o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation unchanged
2025-11-04 12:17:21.601 [File Watcher] INFO  [] o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (0 additions, 0 deletions, 1 modification)
2025-11-04 12:17:21.603 [Thread-58] INFO  [] o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-11-04 12:17:21.648 [tomcat-shutdown] INFO  [] o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-11-04 12:17:21.650 [Thread-58] INFO  [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-04 12:17:21.650 [Thread-58] DEBUG [] org.hibernate.SQL - 
    drop table if exists cliente cascade 
2025-11-04 12:17:21.651 [Thread-58] DEBUG [] org.hibernate.SQL - 
    drop table if exists item_pedido cascade 
2025-11-04 12:17:21.652 [Thread-58] DEBUG [] org.hibernate.SQL - 
    drop table if exists pedido cascade 
2025-11-04 12:17:21.652 [Thread-58] DEBUG [] org.hibernate.SQL - 
    drop table if exists produto cascade 
2025-11-04 12:17:21.653 [Thread-58] DEBUG [] org.hibernate.SQL - 
    drop table if exists restaurante cascade 
2025-11-04 12:17:21.653 [Thread-58] DEBUG [] org.hibernate.SQL - 
    drop table if exists usuario cascade 
2025-11-04 12:17:21.654 [Thread-58] WARN  [] o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-11-04 12:17:21.654 [Thread-58] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-13 - Shutdown initiated...
2025-11-04 12:17:21.655 [Thread-58] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-13 - Shutdown completed.
2025-11-04 12:17:21.746 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - Starting DeliveryApiApplication using Java 17.0.16 with PID 18480 (C:\Users\lidia\OneDrive\Documentos\Curso Arquitetura de Sistemas\deliverytech\delivery-api\target\classes started by lidia in C:\Users\lidia\OneDrive\Documentos\Curso Arquitetura de Sistemas\deliverytech)
2025-11-04 12:17:21.746 [restartedMain] DEBUG [] c.d.d.DeliveryApiApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-11-04 12:17:21.746 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - No active profile set, falling back to 1 default profile: "default"
2025-11-04 12:17:22.189 [restartedMain] INFO  [] o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-04 12:17:22.336 [restartedMain] INFO  [] o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 145 ms. Found 5 JPA repository interfaces.
2025-11-04 12:17:22.383 [restartedMain] INFO  [] o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-04 12:17:22.384 [restartedMain] INFO  [] o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-04 12:17:22.384 [restartedMain] INFO  [] o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-11-04 12:17:22.394 [restartedMain] INFO  [] o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-11-04 12:17:22.394 [restartedMain] INFO  [] o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 647 ms
2025-11-04 12:17:22.441 [restartedMain] INFO  [] o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-04 12:17:22.441 [restartedMain] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-14 - Starting...
2025-11-04 12:17:22.441 [restartedMain] INFO  [] com.zaxxer.hikari.pool.HikariPool - HikariPool-14 - Added connection conn134: url=jdbc:h2:mem:deliverydb user=SA
2025-11-04 12:17:22.441 [restartedMain] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-14 - Start completed.
2025-11-04 12:17:22.441 [restartedMain] WARN  [] org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-11-04 12:17:22.574 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists cliente cascade 
2025-11-04 12:17:22.574 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists item_pedido cascade 
2025-11-04 12:17:22.574 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists pedido cascade 
2025-11-04 12:17:22.574 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists produto cascade 
2025-11-04 12:17:22.574 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists restaurante cascade 
2025-11-04 12:17:22.574 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists usuario cascade 
2025-11-04 12:17:22.574 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table cliente (
        ativo boolean not null,
        data_criacao timestamp(6),
        id bigint generated by default as identity,
        email varchar(255) not null unique,
        endereco varchar(255),
        nome varchar(255) not null,
        telefone varchar(255) not null,
        primary key (id)
    )
2025-11-04 12:17:22.574 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table item_pedido (
        preco_unitario numeric(38,2) not null,
        quantidade integer not null,
        subtotal numeric(38,2) not null,
        id bigint generated by default as identity,
        pedido_id bigint not null,
        produto_id bigint not null,
        observacoes varchar(255),
        primary key (id)
    )
2025-11-04 12:17:22.582 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table pedido (
        subtotal numeric(38,2),
        taxa_entrega numeric(38,2),
        valor_total numeric(38,2),
        cliente_id bigint,
        data_pedido timestamp(6),
        id bigint generated by default as identity,
        restaurante_id bigint,
        cep varchar(255),
        endereco_entrega varchar(255),
        forma_pagamento varchar(255),
        observacoes varchar(255),
        status enum ('CANCELADO','CONFIRMADO','ENTREGUE','PENDENTE','PREPARANDO','SAIU_PARA_ENTREGA'),
        primary key (id)
    )
2025-11-04 12:17:22.582 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table produto (
        disponivel boolean not null,
        preco numeric(38,2),
        id bigint generated by default as identity,
        restaurante_id bigint not null,
        categoria varchar(255),
        descricao varchar(255),
        imagem_url varchar(255),
        nome varchar(255),
        primary key (id)
    )
2025-11-04 12:17:22.582 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table restaurante (
        ativo boolean not null,
        avaliacao numeric(38,2),
        taxa_entrega numeric(38,2),
        tempo_entrega integer,
        id bigint generated by default as identity,
        categoria varchar(255),
        endereco varchar(255),
        horario_funcionamento varchar(255),
        nome varchar(255),
        telefone varchar(255),
        primary key (id)
    )
2025-11-04 12:17:22.582 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table usuario (
        ativo boolean not null,
        data_criacao timestamp(6) not null,
        id bigint generated by default as identity,
        restaurante_id bigint,
        email varchar(255) not null unique,
        nome varchar(255) not null,
        senha varchar(255) not null,
        role enum ('ADMIN','CLIENTE','ENTREGADOR','RESTAURANTE') not null,
        primary key (id)
    )
2025-11-04 12:17:22.582 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists item_pedido 
       add constraint FK60ym08cfoysa17wrn1swyiuda 
       foreign key (pedido_id) 
       references pedido
2025-11-04 12:17:22.586 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists item_pedido 
       add constraint FKtk55mn6d6bvl5h0no5uagi3sf 
       foreign key (produto_id) 
       references produto
2025-11-04 12:17:22.586 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists pedido 
       add constraint FK30s8j2ktpay6of18lbyqn3632 
       foreign key (cliente_id) 
       references cliente
2025-11-04 12:17:22.588 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists pedido 
       add constraint FK3eud5cqmgsnltyk704hu3qj71 
       foreign key (restaurante_id) 
       references restaurante
2025-11-04 12:17:22.589 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists produto 
       add constraint FKb9jhjyghjcn25guim7q4pt8qx 
       foreign key (restaurante_id) 
       references restaurante
2025-11-04 12:17:22.590 [restartedMain] INFO  [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-04 12:17:22.617 [restartedMain] DEBUG [] c.d.d.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-04 12:17:22.618 [restartedMain] DEBUG [] o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-11-04 12:17:22.684 [restartedMain] INFO  [] o.s.s.c.a.a.c.InitializeAuthenticationProviderBeanManagerConfigurer$InitializeAuthenticationProviderManagerConfigurer - Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2025-11-04 12:17:22.684 [restartedMain] WARN  [] o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used by Spring Security for automatically configuring username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider. If the current configuration is intentional, to turn off this warning, increase the logging level of 'org.springframework.security.config.annotation.authentication.configuration.InitializeUserDetailsBeanManagerConfigurer' to ERROR
2025-11-04 12:17:22.825 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'CLIENTE\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.criarPedido(com.deliverytech.delivery_api.dto.PedidoDTO)
2025-11-04 12:17:22.825 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.criarPedido(com.deliverytech.delivery_api.dto.PedidoDTO)]] with attributes [[authorize: 'hasRole('CLIENTE')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:17:22.827 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.listarPedidos(com.deliverytech.delivery_api.model.StatusPedido,java.time.LocalDate,java.time.LocalDate,org.springframework.data.domain.Pageable)
2025-11-04 12:17:22.827 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.listarPedidos(com.deliverytech.delivery_api.model.StatusPedido,java.time.LocalDate,java.time.LocalDate,org.springframework.data.domain.Pageable)]] with attributes [[authorize: 'hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:17:22.828 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'RESTAURANTE\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.buscarPorRestaurante(java.lang.Long,com.deliverytech.delivery_api.model.StatusPedido)
2025-11-04 12:17:22.828 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.buscarPorRestaurante(java.lang.Long,com.deliverytech.delivery_api.model.StatusPedido)]] with attributes [[authorize: 'hasRole('RESTAURANTE')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:17:22.855 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'RESTAURANTE\') or hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.cadastrarProduto(com.deliverytech.delivery_api.dto.ProdutoDTO,java.lang.Long)
2025-11-04 12:17:22.855 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.cadastrarProduto(com.deliverytech.delivery_api.dto.ProdutoDTO,java.lang.Long)]] with attributes [[authorize: 'hasRole('RESTAURANTE') or hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:17:22.856 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or @produtoService.isOwner(#id)") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.removerProduto(java.lang.Long)
2025-11-04 12:17:22.856 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.removerProduto(java.lang.Long)]] with attributes [[authorize: 'hasRole('ADMIN') or @produtoService.isOwner(#id)', filter: 'null', filterTarget: 'null']]
2025-11-04 12:17:22.856 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or @produtoService.isOwner(#id)") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.atualizarProduto(java.lang.Long,com.deliverytech.delivery_api.dto.ProdutoDTO)
2025-11-04 12:17:22.860 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.atualizarProduto(java.lang.Long,com.deliverytech.delivery_api.dto.ProdutoDTO)]] with attributes [[authorize: 'hasRole('ADMIN') or @produtoService.isOwner(#id)', filter: 'null', filterTarget: 'null']]
2025-11-04 12:17:22.890 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.cadastrarRestaurante(com.deliverytech.delivery_api.dto.RestauranteDTO)
2025-11-04 12:17:22.890 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.RestauranteController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.cadastrarRestaurante(com.deliverytech.delivery_api.dto.RestauranteDTO)]] with attributes [[authorize: 'hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:17:22.902 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or (hasRole(\'RESTAURANTE\') and @restauranteService.isOwner(#id))") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.atualizarRestaurante(java.lang.Long,com.deliverytech.delivery_api.dto.RestauranteDTO)
2025-11-04 12:17:22.902 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.RestauranteController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.atualizarRestaurante(java.lang.Long,com.deliverytech.delivery_api.dto.RestauranteDTO)]] with attributes [[authorize: 'hasRole('ADMIN') or (hasRole('RESTAURANTE') and @restauranteService.isOwner(#id))', filter: 'null', filterTarget: 'null']]
2025-11-04 12:17:22.923 [restartedMain] DEBUG [] o.s.w.s.m.m.a.RequestMappingHandlerMapping - 43 mappings in 'requestMappingHandlerMapping'
2025-11-04 12:17:22.938 [restartedMain] DEBUG [] o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**, /swagger-ui*/*swagger-initializer.js, /swagger-ui*/**] in 'resourceHandlerMapping'
2025-11-04 12:17:22.962 [restartedMain] INFO  [] o.s.b.a.e.web.EndpointLinksResolver - Exposing 6 endpoints beneath base path '/actuator'
2025-11-04 12:17:22.989 [restartedMain] DEBUG [] o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-11-04 12:17:22.990 [restartedMain] DEBUG [] o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-11-04 12:17:23.004 [restartedMain] DEBUG [] o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 2 @ExceptionHandler, 1 ResponseBodyAdvice
2025-11-04 12:17:23.017 [restartedMain] INFO  [] o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:deliverydb'
2025-11-04 12:17:23.035 [restartedMain] INFO  [] o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-11-04 12:17:23.035 [restartedMain] INFO  [] o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-11-04 12:17:23.051 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - Started DeliveryApiApplication in 1.329 seconds (process running for 7080.138)
2025-11-04 12:17:23.053 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Cliente */insert 
    into
        cliente (ativo, data_criacao, email, endereco, nome, telefone, id) 
    values
        (?, ?, ?, ?, ?, ?, default)
2025-11-04 12:17:23.057 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Cliente */insert 
    into
        cliente (ativo, data_criacao, email, endereco, nome, telefone, id) 
    values
        (?, ?, ?, ?, ?, ?, default)
2025-11-04 12:17:23.059 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Restaurante */insert 
    into
        restaurante (ativo, avaliacao, categoria, endereco, horario_funcionamento, nome, taxa_entrega, telefone, tempo_entrega, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2025-11-04 12:17:23.061 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Restaurante */insert 
    into
        restaurante (ativo, avaliacao, categoria, endereco, horario_funcionamento, nome, taxa_entrega, telefone, tempo_entrega, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2025-11-04 12:17:23.074 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        c1_0.email=?
2025-11-04 12:17:23.074 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        c1_0.ativo
2025-11-04 12:17:23.084 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        upper(c1_0.nome) like upper(?) escape '\'
2025-11-04 12:17:23.088 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id 
    from
        cliente c1_0 
    where
        c1_0.email=? 
    fetch
        first ? rows only
2025-11-04 12:17:23.089 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.ativo
2025-11-04 12:17:23.093 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.categoria=?
2025-11-04 12:17:23.096 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.taxa_entrega<=?
2025-11-04 12:17:23.099 [restartedMain] INFO  [] o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation unchanged
2025-11-04 12:22:21.997 [File Watcher] INFO  [] o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (1 addition, 0 deletions, 0 modifications)
2025-11-04 12:22:21.999 [Thread-62] INFO  [] o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-11-04 12:22:22.036 [tomcat-shutdown] INFO  [] o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-11-04 12:22:22.038 [Thread-62] INFO  [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-04 12:22:22.038 [Thread-62] DEBUG [] org.hibernate.SQL - 
    drop table if exists cliente cascade 
2025-11-04 12:22:22.039 [Thread-62] DEBUG [] org.hibernate.SQL - 
    drop table if exists item_pedido cascade 
2025-11-04 12:22:22.040 [Thread-62] DEBUG [] org.hibernate.SQL - 
    drop table if exists pedido cascade 
2025-11-04 12:22:22.040 [Thread-62] DEBUG [] org.hibernate.SQL - 
    drop table if exists produto cascade 
2025-11-04 12:22:22.040 [Thread-62] DEBUG [] org.hibernate.SQL - 
    drop table if exists restaurante cascade 
2025-11-04 12:22:22.040 [Thread-62] DEBUG [] org.hibernate.SQL - 
    drop table if exists usuario cascade 
2025-11-04 12:22:22.040 [Thread-62] WARN  [] o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-11-04 12:22:22.040 [Thread-62] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-14 - Shutdown initiated...
2025-11-04 12:22:22.042 [Thread-62] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-14 - Shutdown completed.
2025-11-04 12:22:22.135 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - Starting DeliveryApiApplication using Java 17.0.16 with PID 18480 (C:\Users\lidia\OneDrive\Documentos\Curso Arquitetura de Sistemas\deliverytech\delivery-api\target\classes started by lidia in C:\Users\lidia\OneDrive\Documentos\Curso Arquitetura de Sistemas\deliverytech)
2025-11-04 12:22:22.135 [restartedMain] DEBUG [] c.d.d.DeliveryApiApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-11-04 12:22:22.136 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - No active profile set, falling back to 1 default profile: "default"
2025-11-04 12:22:22.389 [restartedMain] INFO  [] o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-04 12:22:22.407 [restartedMain] INFO  [] o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 5 JPA repository interfaces.
2025-11-04 12:22:22.465 [restartedMain] INFO  [] o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-04 12:22:22.466 [restartedMain] INFO  [] o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-04 12:22:22.466 [restartedMain] INFO  [] o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-11-04 12:22:22.477 [restartedMain] INFO  [] o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-11-04 12:22:22.477 [restartedMain] INFO  [] o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 339 ms
2025-11-04 12:22:22.510 [restartedMain] INFO  [] o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-04 12:22:22.511 [restartedMain] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-15 - Starting...
2025-11-04 12:22:22.512 [restartedMain] INFO  [] com.zaxxer.hikari.pool.HikariPool - HikariPool-15 - Added connection conn144: url=jdbc:h2:mem:deliverydb user=SA
2025-11-04 12:22:22.512 [restartedMain] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-15 - Start completed.
2025-11-04 12:22:22.512 [restartedMain] WARN  [] org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-11-04 12:22:22.588 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists cliente cascade 
2025-11-04 12:22:22.588 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists item_pedido cascade 
2025-11-04 12:22:22.588 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists pedido cascade 
2025-11-04 12:22:22.588 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists produto cascade 
2025-11-04 12:22:22.588 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists restaurante cascade 
2025-11-04 12:22:22.588 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists usuario cascade 
2025-11-04 12:22:22.588 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table cliente (
        ativo boolean not null,
        data_criacao timestamp(6),
        id bigint generated by default as identity,
        email varchar(255) not null unique,
        endereco varchar(255),
        nome varchar(255) not null,
        telefone varchar(255) not null,
        primary key (id)
    )
2025-11-04 12:22:22.588 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table item_pedido (
        preco_unitario numeric(38,2) not null,
        quantidade integer not null,
        subtotal numeric(38,2) not null,
        id bigint generated by default as identity,
        pedido_id bigint not null,
        produto_id bigint not null,
        observacoes varchar(255),
        primary key (id)
    )
2025-11-04 12:22:22.588 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table pedido (
        subtotal numeric(38,2),
        taxa_entrega numeric(38,2),
        valor_total numeric(38,2),
        cliente_id bigint,
        data_pedido timestamp(6),
        id bigint generated by default as identity,
        restaurante_id bigint,
        cep varchar(255),
        endereco_entrega varchar(255),
        forma_pagamento varchar(255),
        observacoes varchar(255),
        status enum ('CANCELADO','CONFIRMADO','ENTREGUE','PENDENTE','PREPARANDO','SAIU_PARA_ENTREGA'),
        primary key (id)
    )
2025-11-04 12:22:22.588 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table produto (
        disponivel boolean not null,
        preco numeric(38,2),
        id bigint generated by default as identity,
        restaurante_id bigint not null,
        categoria varchar(255),
        descricao varchar(255),
        imagem_url varchar(255),
        nome varchar(255),
        primary key (id)
    )
2025-11-04 12:22:22.588 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table restaurante (
        ativo boolean not null,
        avaliacao numeric(38,2),
        taxa_entrega numeric(38,2),
        tempo_entrega integer,
        id bigint generated by default as identity,
        categoria varchar(255),
        endereco varchar(255),
        horario_funcionamento varchar(255),
        nome varchar(255),
        telefone varchar(255),
        primary key (id)
    )
2025-11-04 12:22:22.598 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table usuario (
        ativo boolean not null,
        data_criacao timestamp(6) not null,
        id bigint generated by default as identity,
        restaurante_id bigint,
        email varchar(255) not null unique,
        nome varchar(255) not null,
        senha varchar(255) not null,
        role enum ('ADMIN','CLIENTE','ENTREGADOR','RESTAURANTE') not null,
        primary key (id)
    )
2025-11-04 12:22:22.600 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists item_pedido 
       add constraint FK60ym08cfoysa17wrn1swyiuda 
       foreign key (pedido_id) 
       references pedido
2025-11-04 12:22:22.602 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists item_pedido 
       add constraint FKtk55mn6d6bvl5h0no5uagi3sf 
       foreign key (produto_id) 
       references produto
2025-11-04 12:22:22.604 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists pedido 
       add constraint FK30s8j2ktpay6of18lbyqn3632 
       foreign key (cliente_id) 
       references cliente
2025-11-04 12:22:22.604 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists pedido 
       add constraint FK3eud5cqmgsnltyk704hu3qj71 
       foreign key (restaurante_id) 
       references restaurante
2025-11-04 12:22:22.604 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists produto 
       add constraint FKb9jhjyghjcn25guim7q4pt8qx 
       foreign key (restaurante_id) 
       references restaurante
2025-11-04 12:22:22.604 [restartedMain] INFO  [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-04 12:22:22.642 [restartedMain] DEBUG [] c.d.d.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-04 12:22:22.642 [restartedMain] DEBUG [] o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-11-04 12:22:22.685 [restartedMain] INFO  [] o.s.s.c.a.a.c.InitializeAuthenticationProviderBeanManagerConfigurer$InitializeAuthenticationProviderManagerConfigurer - Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2025-11-04 12:22:22.685 [restartedMain] WARN  [] o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used by Spring Security for automatically configuring username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider. If the current configuration is intentional, to turn off this warning, increase the logging level of 'org.springframework.security.config.annotation.authentication.configuration.InitializeUserDetailsBeanManagerConfigurer' to ERROR
2025-11-04 12:22:22.734 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'CLIENTE\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.criarPedido(com.deliverytech.delivery_api.dto.PedidoDTO)
2025-11-04 12:22:22.734 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.criarPedido(com.deliverytech.delivery_api.dto.PedidoDTO)]] with attributes [[authorize: 'hasRole('CLIENTE')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:22:22.734 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.listarPedidos(com.deliverytech.delivery_api.model.StatusPedido,java.time.LocalDate,java.time.LocalDate,org.springframework.data.domain.Pageable)
2025-11-04 12:22:22.734 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.listarPedidos(com.deliverytech.delivery_api.model.StatusPedido,java.time.LocalDate,java.time.LocalDate,org.springframework.data.domain.Pageable)]] with attributes [[authorize: 'hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:22:22.734 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'RESTAURANTE\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.buscarPorRestaurante(java.lang.Long,com.deliverytech.delivery_api.model.StatusPedido)
2025-11-04 12:22:22.734 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.buscarPorRestaurante(java.lang.Long,com.deliverytech.delivery_api.model.StatusPedido)]] with attributes [[authorize: 'hasRole('RESTAURANTE')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:22:22.751 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'RESTAURANTE\') or hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.cadastrarProduto(com.deliverytech.delivery_api.dto.ProdutoDTO,java.lang.Long)
2025-11-04 12:22:22.751 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.cadastrarProduto(com.deliverytech.delivery_api.dto.ProdutoDTO,java.lang.Long)]] with attributes [[authorize: 'hasRole('RESTAURANTE') or hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:22:22.751 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or @produtoService.isOwner(#id)") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.removerProduto(java.lang.Long)
2025-11-04 12:22:22.751 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.removerProduto(java.lang.Long)]] with attributes [[authorize: 'hasRole('ADMIN') or @produtoService.isOwner(#id)', filter: 'null', filterTarget: 'null']]
2025-11-04 12:22:22.751 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or @produtoService.isOwner(#id)") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.atualizarProduto(java.lang.Long,com.deliverytech.delivery_api.dto.ProdutoDTO)
2025-11-04 12:22:22.755 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.atualizarProduto(java.lang.Long,com.deliverytech.delivery_api.dto.ProdutoDTO)]] with attributes [[authorize: 'hasRole('ADMIN') or @produtoService.isOwner(#id)', filter: 'null', filterTarget: 'null']]
2025-11-04 12:22:22.760 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.cadastrarRestaurante(com.deliverytech.delivery_api.dto.RestauranteDTO)
2025-11-04 12:22:22.760 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.RestauranteController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.cadastrarRestaurante(com.deliverytech.delivery_api.dto.RestauranteDTO)]] with attributes [[authorize: 'hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:22:22.760 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or (hasRole(\'RESTAURANTE\') and @restauranteService.isOwner(#id))") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.atualizarRestaurante(java.lang.Long,com.deliverytech.delivery_api.dto.RestauranteDTO)
2025-11-04 12:22:22.763 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.RestauranteController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.atualizarRestaurante(java.lang.Long,com.deliverytech.delivery_api.dto.RestauranteDTO)]] with attributes [[authorize: 'hasRole('ADMIN') or (hasRole('RESTAURANTE') and @restauranteService.isOwner(#id))', filter: 'null', filterTarget: 'null']]
2025-11-04 12:22:22.785 [restartedMain] DEBUG [] o.s.w.s.m.m.a.RequestMappingHandlerMapping - 43 mappings in 'requestMappingHandlerMapping'
2025-11-04 12:22:22.818 [restartedMain] DEBUG [] o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**, /swagger-ui*/*swagger-initializer.js, /swagger-ui*/**] in 'resourceHandlerMapping'
2025-11-04 12:22:22.838 [restartedMain] INFO  [] o.s.b.a.e.web.EndpointLinksResolver - Exposing 6 endpoints beneath base path '/actuator'
2025-11-04 12:22:22.857 [restartedMain] DEBUG [] o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-11-04 12:22:22.868 [restartedMain] DEBUG [] o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-11-04 12:22:22.868 [restartedMain] DEBUG [] o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 2 @ExceptionHandler, 1 ResponseBodyAdvice
2025-11-04 12:22:22.892 [restartedMain] INFO  [] o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:deliverydb'
2025-11-04 12:22:22.899 [restartedMain] INFO  [] o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-11-04 12:22:22.907 [restartedMain] INFO  [] o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-11-04 12:22:22.916 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - Started DeliveryApiApplication in 0.805 seconds (process running for 7380.004)
2025-11-04 12:22:22.920 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Cliente */insert 
    into
        cliente (ativo, data_criacao, email, endereco, nome, telefone, id) 
    values
        (?, ?, ?, ?, ?, ?, default)
2025-11-04 12:22:22.923 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Cliente */insert 
    into
        cliente (ativo, data_criacao, email, endereco, nome, telefone, id) 
    values
        (?, ?, ?, ?, ?, ?, default)
2025-11-04 12:22:22.927 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Restaurante */insert 
    into
        restaurante (ativo, avaliacao, categoria, endereco, horario_funcionamento, nome, taxa_entrega, telefone, tempo_entrega, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2025-11-04 12:22:22.928 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Restaurante */insert 
    into
        restaurante (ativo, avaliacao, categoria, endereco, horario_funcionamento, nome, taxa_entrega, telefone, tempo_entrega, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2025-11-04 12:22:22.942 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        c1_0.email=?
2025-11-04 12:22:22.949 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        c1_0.ativo
2025-11-04 12:22:22.953 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        upper(c1_0.nome) like upper(?) escape '\'
2025-11-04 12:22:22.957 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id 
    from
        cliente c1_0 
    where
        c1_0.email=? 
    fetch
        first ? rows only
2025-11-04 12:22:22.957 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.ativo
2025-11-04 12:22:22.957 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.categoria=?
2025-11-04 12:22:22.968 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.taxa_entrega<=?
2025-11-04 12:22:22.970 [restartedMain] INFO  [] o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation unchanged
2025-11-04 12:34:11.445 [File Watcher] INFO  [] o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (0 additions, 0 deletions, 1 modification)
2025-11-04 12:34:11.445 [Thread-66] INFO  [] o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-11-04 12:34:11.487 [tomcat-shutdown] INFO  [] o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-11-04 12:34:11.491 [Thread-66] INFO  [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-11-04 12:34:11.491 [Thread-66] DEBUG [] org.hibernate.SQL - 
    drop table if exists cliente cascade 
2025-11-04 12:34:11.491 [Thread-66] DEBUG [] org.hibernate.SQL - 
    drop table if exists item_pedido cascade 
2025-11-04 12:34:11.491 [Thread-66] DEBUG [] org.hibernate.SQL - 
    drop table if exists pedido cascade 
2025-11-04 12:34:11.491 [Thread-66] DEBUG [] org.hibernate.SQL - 
    drop table if exists produto cascade 
2025-11-04 12:34:11.491 [Thread-66] DEBUG [] org.hibernate.SQL - 
    drop table if exists restaurante cascade 
2025-11-04 12:34:11.491 [Thread-66] DEBUG [] org.hibernate.SQL - 
    drop table if exists usuario cascade 
2025-11-04 12:34:11.491 [Thread-66] WARN  [] o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-11-04 12:34:11.491 [Thread-66] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-15 - Shutdown initiated...
2025-11-04 12:34:11.491 [Thread-66] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-15 - Shutdown completed.
2025-11-04 12:34:11.581 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - Starting DeliveryApiApplication using Java 17.0.16 with PID 18480 (C:\Users\lidia\OneDrive\Documentos\Curso Arquitetura de Sistemas\deliverytech\delivery-api\target\classes started by lidia in C:\Users\lidia\OneDrive\Documentos\Curso Arquitetura de Sistemas\deliverytech)
2025-11-04 12:34:11.581 [restartedMain] DEBUG [] c.d.d.DeliveryApiApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-11-04 12:34:11.581 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - No active profile set, falling back to 1 default profile: "default"
2025-11-04 12:34:11.765 [restartedMain] INFO  [] o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-11-04 12:34:11.781 [restartedMain] INFO  [] o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 15 ms. Found 5 JPA repository interfaces.
2025-11-04 12:34:11.857 [restartedMain] INFO  [] o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-04 12:34:11.858 [restartedMain] INFO  [] o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-04 12:34:11.859 [restartedMain] INFO  [] o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-11-04 12:34:11.869 [restartedMain] INFO  [] o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-11-04 12:34:11.870 [restartedMain] INFO  [] o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 289 ms
2025-11-04 12:34:11.905 [restartedMain] INFO  [] o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-11-04 12:34:11.905 [restartedMain] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-16 - Starting...
2025-11-04 12:34:11.905 [restartedMain] INFO  [] com.zaxxer.hikari.pool.HikariPool - HikariPool-16 - Added connection conn154: url=jdbc:h2:mem:deliverydb user=SA
2025-11-04 12:34:11.905 [restartedMain] INFO  [] com.zaxxer.hikari.HikariDataSource - HikariPool-16 - Start completed.
2025-11-04 12:34:11.915 [restartedMain] WARN  [] org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-11-04 12:34:11.966 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists cliente cascade 
2025-11-04 12:34:11.966 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists item_pedido cascade 
2025-11-04 12:34:11.966 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists pedido cascade 
2025-11-04 12:34:11.966 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists produto cascade 
2025-11-04 12:34:11.966 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists restaurante cascade 
2025-11-04 12:34:11.966 [restartedMain] DEBUG [] org.hibernate.SQL - 
    drop table if exists usuario cascade 
2025-11-04 12:34:11.966 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table cliente (
        ativo boolean not null,
        data_criacao timestamp(6),
        id bigint generated by default as identity,
        email varchar(255) not null unique,
        endereco varchar(255),
        nome varchar(255) not null,
        telefone varchar(255) not null,
        primary key (id)
    )
2025-11-04 12:34:11.966 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table item_pedido (
        preco_unitario numeric(38,2) not null,
        quantidade integer not null,
        subtotal numeric(38,2) not null,
        id bigint generated by default as identity,
        pedido_id bigint not null,
        produto_id bigint not null,
        observacoes varchar(255),
        primary key (id)
    )
2025-11-04 12:34:11.966 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table pedido (
        subtotal numeric(38,2),
        taxa_entrega numeric(38,2),
        valor_total numeric(38,2),
        cliente_id bigint,
        data_pedido timestamp(6),
        id bigint generated by default as identity,
        restaurante_id bigint,
        cep varchar(255),
        endereco_entrega varchar(255),
        forma_pagamento varchar(255),
        observacoes varchar(255),
        status enum ('CANCELADO','CONFIRMADO','ENTREGUE','PENDENTE','PREPARANDO','SAIU_PARA_ENTREGA'),
        primary key (id)
    )
2025-11-04 12:34:11.966 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table produto (
        disponivel boolean not null,
        preco numeric(38,2),
        id bigint generated by default as identity,
        restaurante_id bigint not null,
        categoria varchar(255),
        descricao varchar(255),
        imagem_url varchar(255),
        nome varchar(255),
        primary key (id)
    )
2025-11-04 12:34:11.966 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table restaurante (
        ativo boolean not null,
        avaliacao numeric(38,2),
        taxa_entrega numeric(38,2),
        tempo_entrega integer,
        id bigint generated by default as identity,
        categoria varchar(255),
        endereco varchar(255),
        horario_funcionamento varchar(255),
        nome varchar(255),
        telefone varchar(255),
        primary key (id)
    )
2025-11-04 12:34:11.981 [restartedMain] DEBUG [] org.hibernate.SQL - 
    create table usuario (
        ativo boolean not null,
        data_criacao timestamp(6) not null,
        id bigint generated by default as identity,
        restaurante_id bigint,
        email varchar(255) not null unique,
        nome varchar(255) not null,
        senha varchar(255) not null,
        role enum ('ADMIN','CLIENTE','ENTREGADOR','RESTAURANTE') not null,
        primary key (id)
    )
2025-11-04 12:34:11.984 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists item_pedido 
       add constraint FK60ym08cfoysa17wrn1swyiuda 
       foreign key (pedido_id) 
       references pedido
2025-11-04 12:34:11.985 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists item_pedido 
       add constraint FKtk55mn6d6bvl5h0no5uagi3sf 
       foreign key (produto_id) 
       references produto
2025-11-04 12:34:11.986 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists pedido 
       add constraint FK30s8j2ktpay6of18lbyqn3632 
       foreign key (cliente_id) 
       references cliente
2025-11-04 12:34:11.986 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists pedido 
       add constraint FK3eud5cqmgsnltyk704hu3qj71 
       foreign key (restaurante_id) 
       references restaurante
2025-11-04 12:34:11.987 [restartedMain] DEBUG [] org.hibernate.SQL - 
    alter table if exists produto 
       add constraint FKb9jhjyghjcn25guim7q4pt8qx 
       foreign key (restaurante_id) 
       references restaurante
2025-11-04 12:34:11.987 [restartedMain] INFO  [] o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-11-04 12:34:12.019 [restartedMain] DEBUG [] c.d.d.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-04 12:34:12.020 [restartedMain] DEBUG [] o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-11-04 12:34:12.087 [restartedMain] INFO  [] o.s.s.c.a.a.c.InitializeAuthenticationProviderBeanManagerConfigurer$InitializeAuthenticationProviderManagerConfigurer - Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationProvider
2025-11-04 12:34:12.088 [restartedMain] WARN  [] o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService beans will not be used by Spring Security for automatically configuring username/password login. Consider removing the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually instantiated DaoAuthenticationProvider. If the current configuration is intentional, to turn off this warning, increase the logging level of 'org.springframework.security.config.annotation.authentication.configuration.InitializeUserDetailsBeanManagerConfigurer' to ERROR
2025-11-04 12:34:12.134 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'CLIENTE\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.criarPedido(com.deliverytech.delivery_api.dto.PedidoDTO)
2025-11-04 12:34:12.134 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.criarPedido(com.deliverytech.delivery_api.dto.PedidoDTO)]] with attributes [[authorize: 'hasRole('CLIENTE')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:34:12.134 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.listarPedidos(com.deliverytech.delivery_api.model.StatusPedido,java.time.LocalDate,java.time.LocalDate,org.springframework.data.domain.Pageable)
2025-11-04 12:34:12.134 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.listarPedidos(com.deliverytech.delivery_api.model.StatusPedido,java.time.LocalDate,java.time.LocalDate,org.springframework.data.domain.Pageable)]] with attributes [[authorize: 'hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:34:12.134 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'RESTAURANTE\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.buscarPorRestaurante(java.lang.Long,com.deliverytech.delivery_api.model.StatusPedido)
2025-11-04 12:34:12.134 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.PedidoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.PedidoController.buscarPorRestaurante(java.lang.Long,com.deliverytech.delivery_api.model.StatusPedido)]] with attributes [[authorize: 'hasRole('RESTAURANTE')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:34:12.146 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'RESTAURANTE\') or hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.cadastrarProduto(com.deliverytech.delivery_api.dto.ProdutoDTO,java.lang.Long)
2025-11-04 12:34:12.146 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.cadastrarProduto(com.deliverytech.delivery_api.dto.ProdutoDTO,java.lang.Long)]] with attributes [[authorize: 'hasRole('RESTAURANTE') or hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:34:12.146 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or @produtoService.isOwner(#id)") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.removerProduto(java.lang.Long)
2025-11-04 12:34:12.147 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.removerProduto(java.lang.Long)]] with attributes [[authorize: 'hasRole('ADMIN') or @produtoService.isOwner(#id)', filter: 'null', filterTarget: 'null']]
2025-11-04 12:34:12.147 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or @produtoService.isOwner(#id)") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.atualizarProduto(java.lang.Long,com.deliverytech.delivery_api.dto.ProdutoDTO)
2025-11-04 12:34:12.148 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.ProdutoController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.ProdutoController.atualizarProduto(java.lang.Long,com.deliverytech.delivery_api.dto.ProdutoDTO)]] with attributes [[authorize: 'hasRole('ADMIN') or @produtoService.isOwner(#id)', filter: 'null', filterTarget: 'null']]
2025-11-04 12:34:12.152 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\')") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.cadastrarRestaurante(com.deliverytech.delivery_api.dto.RestauranteDTO)
2025-11-04 12:34:12.152 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.RestauranteController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.cadastrarRestaurante(com.deliverytech.delivery_api.dto.RestauranteDTO)]] with attributes [[authorize: 'hasRole('ADMIN')', filter: 'null', filterTarget: 'null']]
2025-11-04 12:34:12.152 [restartedMain] DEBUG [] o.s.s.a.p.PrePostAnnotationSecurityMetadataSource - @org.springframework.security.access.prepost.PreAuthorize("hasRole(\'ADMIN\') or (hasRole(\'RESTAURANTE\') and @restauranteService.isOwner(#id))") found on specific method: public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.atualizarRestaurante(java.lang.Long,com.deliverytech.delivery_api.dto.RestauranteDTO)
2025-11-04 12:34:12.155 [restartedMain] DEBUG [] o.s.s.a.m.DelegatingMethodSecurityMetadataSource - Caching method [CacheKey[com.deliverytech.delivery_api.controller.RestauranteController; public org.springframework.http.ResponseEntity com.deliverytech.delivery_api.controller.RestauranteController.atualizarRestaurante(java.lang.Long,com.deliverytech.delivery_api.dto.RestauranteDTO)]] with attributes [[authorize: 'hasRole('ADMIN') or (hasRole('RESTAURANTE') and @restauranteService.isOwner(#id))', filter: 'null', filterTarget: 'null']]
2025-11-04 12:34:12.188 [restartedMain] DEBUG [] o.s.w.s.m.m.a.RequestMappingHandlerMapping - 43 mappings in 'requestMappingHandlerMapping'
2025-11-04 12:34:12.221 [restartedMain] DEBUG [] o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**, /swagger-ui*/*swagger-initializer.js, /swagger-ui*/**] in 'resourceHandlerMapping'
2025-11-04 12:34:12.255 [restartedMain] INFO  [] o.s.b.a.e.web.EndpointLinksResolver - Exposing 6 endpoints beneath base path '/actuator'
2025-11-04 12:34:12.283 [restartedMain] DEBUG [] o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthenticationFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-11-04 12:34:12.304 [restartedMain] DEBUG [] o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-11-04 12:34:12.320 [restartedMain] DEBUG [] o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 2 @ExceptionHandler, 1 ResponseBodyAdvice
2025-11-04 12:34:12.366 [restartedMain] INFO  [] o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:deliverydb'
2025-11-04 12:34:12.385 [restartedMain] INFO  [] o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-11-04 12:34:12.398 [restartedMain] INFO  [] o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-11-04 12:34:12.403 [restartedMain] INFO  [] c.d.d.DeliveryApiApplication - Started DeliveryApiApplication in 0.843 seconds (process running for 8089.491)
2025-11-04 12:34:12.407 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Cliente */insert 
    into
        cliente (ativo, data_criacao, email, endereco, nome, telefone, id) 
    values
        (?, ?, ?, ?, ?, ?, default)
2025-11-04 12:34:12.409 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Cliente */insert 
    into
        cliente (ativo, data_criacao, email, endereco, nome, telefone, id) 
    values
        (?, ?, ?, ?, ?, ?, default)
2025-11-04 12:34:12.410 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Restaurante */insert 
    into
        restaurante (ativo, avaliacao, categoria, endereco, horario_funcionamento, nome, taxa_entrega, telefone, tempo_entrega, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2025-11-04 12:34:12.410 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* insert for
        com.deliverytech.delivery_api.model.Restaurante */insert 
    into
        restaurante (ativo, avaliacao, categoria, endereco, horario_funcionamento, nome, taxa_entrega, telefone, tempo_entrega, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, default)
2025-11-04 12:34:12.422 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        c1_0.email=?
2025-11-04 12:34:12.428 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        c1_0.ativo
2025-11-04 12:34:12.432 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id,
        c1_0.ativo,
        c1_0.data_criacao,
        c1_0.email,
        c1_0.endereco,
        c1_0.nome,
        c1_0.telefone 
    from
        cliente c1_0 
    where
        upper(c1_0.nome) like upper(?) escape '\'
2025-11-04 12:34:12.435 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        c1_0.id 
    from
        cliente c1_0 
    where
        c1_0.email=? 
    fetch
        first ? rows only
2025-11-04 12:34:12.438 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.ativo
2025-11-04 12:34:12.441 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.categoria=?
2025-11-04 12:34:12.442 [restartedMain] DEBUG [] org.hibernate.SQL - 
    /* <criteria> */ select
        r1_0.id,
        r1_0.ativo,
        r1_0.avaliacao,
        r1_0.categoria,
        r1_0.endereco,
        r1_0.horario_funcionamento,
        r1_0.nome,
        r1_0.taxa_entrega,
        r1_0.telefone,
        r1_0.tempo_entrega 
    from
        restaurante r1_0 
    where
        r1_0.taxa_entrega<=?
2025-11-04 12:34:12.442 [restartedMain] INFO  [] o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation unchanged
